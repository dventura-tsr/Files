<html>
<head>
<script src="https://cdn.prod.us.five9.net/static/alpha/chat/wrapper/index.js"></script>
</head>

<body>
<script>
  // Function to update the "name" field dynamically
  function updateNameField() {
    // Select the first name and last name input fields
    const firstNameInput = document.querySelector('input[name="first_name"]');
    const lastNameInput = document.querySelector('input[name="last_name"]');

    // If both fields exist, listen for input changes
    if (firstNameInput && lastNameInput) {
      function setFullName() {
        const fullName = `${firstNameInput.value.trim()} ${lastNameInput.value.trim()}`.trim();

        // Update the prepopulated fields with the full name
        F9.Chat.Wrapper.updatePrepopulatedFields([
          { "k": "campaign", "v": "Dan_Chat" },
          { "k": "name", "v": fullName }
        ]);
      }

      // Attach event listeners to update the name in real-time
      firstNameInput.addEventListener("input", setFullName);
      lastNameInput.addEventListener("input", setFullName);
    }
  }

  // Initialize Five9 Chat
  F9.Chat.Wrapper.init({
    cdn: 'alpha-us',
    useBusinessHours: false,
    languages: { "enabled": false, "backgroundColor": "#65758e" },
    l10n: {
      "en": {
        "messenger": { "customText": {} },
        "systemMessages": {
          "transferredToParticipant": "The chat has been transferred to {name}.",
          "transferredToGroup": "That chat has been transferred to group {group}."
        },
        "captureFields": [
          { "k": "first_name", "l": "First Name", "p": "Enter your name..." },
          { "k": "last_name", "l": "Last Name", "p": "Enter your last name..." },
          { "k": "email", "l": "Email Address", "p": "Enter your email..." },
          { "k": "Question", "l": "Question", "p": "What can we help you with today?" }
        ]
      }
    },
    prepopulatedFields: [
      { "k": "campaign", "v": "Dan_Chat" },
      { "k": "name", "v": "" }
    ],
    messenger: {
      "integrationId": "6227e8d6b2944300f32d37a9",
      "soundNotificationEnabled": true,
      "transcriptPrintingEnabled": false,
      "menuItems": {
        "imageUpload": true,
        "fileUpload": true,
        "shareLocation": true
      },
      "embedded": false,
      "setViewportScale": false,
      "browserStorage": "sessionStorage",
      "hideWidgetAfterBusinessHours": false,
      "openLinkInSameTab": false,
      "scheduleCallback": {
        "isCallbackEnabled": false,
        "requestCallbackList": "",
        "customConfirmationMessage": "We will call you as soon as we can at [PHONE]",
        "web2CampaignAPIHost": ""
      },
      "fixedHeader": false,
      "displayStyle": "button",
      "customColors": {
        "brandColor": "65758e",
        "conversationColor": "4B5DFF",
        "actionColor": "4B5DFF"
      },
      "carouselType": "default"
    },
    clearMessagesTimeout: 3
  });

  // Wait for the chat widget to load before running updateNameField
  F9.Chat.Wrapper.on('onLoad', function() {
    console.log("Chat Loaded, attaching name update handler...");
    setTimeout(updateNameField, 1000); // Ensure fields are rendered
  });

</script>
</body>
</html>
