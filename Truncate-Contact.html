<html>
<head>
<script src="https://cdn.prod.us.five9.net/static/alpha/chat/wrapper/index.js"></script>
</head>

<body>
<script>
  // Function to update the "name" field dynamically
  function updateNameField() {
    console.log("Updating name field...");
    
    // Select the first name and last name input fields
    const firstNameInput = document.querySelector('input[name="first_name"]');
    const lastNameInput = document.querySelector('input[name="last_name"]');

    if (firstNameInput && lastNameInput) {
      function setFullName() {
        const fullName = `${firstNameInput.value.trim()} ${lastNameInput.value.trim()}`.trim();

        // Ensure F9.Chat.Wrapper.updatePrepopulatedFields exists before calling it
        if (F9.Chat.Wrapper && typeof F9.Chat.Wrapper.updatePrepopulatedFields === "function") {
          F9.Chat.Wrapper.updatePrepopulatedFields([
            { "k": "campaign", "v": "Dan_Chat" },
            { "k": "name", "v": fullName }
          ]);
          console.log("Updated prepopulated fields with full name:", fullName);
        } else {
          console.error("updatePrepopulatedFields is not available");
        }
      }

      // Attach event listeners to update the name in real-time
      firstNameInput.addEventListener("input", setFullName);
      lastNameInput.addEventListener("input", setFullName);
    } else {
      console.error("First name or last name input field not found");
    }
  }

  // Initialize Five9 Chat
  F9.Chat.Wrapper.init({
    cdn: 'alpha-us',
    useBusinessHours: false,
    languages: { "enabled": false, "backgroundColor": "#65758e" },
    l10n: {
      "en": {
        "messenger": { "customText": {} },
        "systemMessages": {
          "transferredToParticipant": "The chat has been transferred to {name}.",
          "transferredToGroup": "That chat has been transferred to group {group}."
        },
        "captureFields": [
          { "k": "first_name", "l": "First Name", "p": "Enter your name..." },
          { "k": "last_name", "l": "Last Name", "p": "Enter your last name..." },
          { "k": "email", "l": "Email Address", "p": "Enter your email..." },
          { "k": "Question", "l": "Question", "p": "What can we help you with today?" }
        ]
      }
    },
    prepopulatedFields: [
      { "k": "campaign", "v": "Dan_Chat" },
      { "k": "name", "v": "" }
    ],
    messenger: {
      "integrationId": "6227e8d6b2944300f32d37a9",
      "soundNotificationEnabled": true,
      "transcriptPrintingEnabled": false,
      "menuItems": {
        "imageUpload": true,
        "fileUpload": true,
        "shareLocation": true
      },
      "embedded": false,
      "setViewportScale": false,
      "browserStorage": "sessionStorage",
      "hideWidgetAfterBusinessHours": false,
      "openLinkInSameTab": false,
      "scheduleCallback": {
        "isCallbackEnabled": false,
        "requestCallbackList": "",
        "customConfirmationMessage": "We will call you as soon as we can at [PHONE]",
        "web2CampaignAPIHost": ""
      },
      "fixedHeader": false,
      "displayStyle": "button",
      "customColors": {
        "brandColor": "65758e",
        "conversationColor": "4B5DFF",
        "actionColor": "4B5DFF"
      },
      "carouselType": "default"
    },
    clearMessagesTimeout: 3
  });

  // Polling method to check when chat is ready
  const checkChatReady = setInterval(() => {
    if (F9.Chat.Wrapper && typeof F9.Chat.Wrapper.updatePrepopulatedFields === "function") {
      console.log("Chat is ready. Running updateNameField...");
      updateNameField();
      clearInterval(checkChatReady);
    }
  }, 1000); // Check every second

</script>
</body>
</html>
